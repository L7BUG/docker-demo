services:
    pulsar-standalone:
        image: apachepulsar/pulsar:4.1.1
        container_name: pulsar-standalone
        ports:
            - "16650:6650"
            - "18080:8080"
        volumes:
            - pulsardata:/pulsar/data
            - pulsarconf:/pulsar/conf
        command: bin/pulsar standalone
        restart: unless-stopped
        environment:
            TZ: Asia/Shanghai
            PULSAR_MEM: "-Xms512m -Xmx512m"
    # Pulsar Manager
    pulsar-manager:
        image: apachepulsar/pulsar-manager:v0.4.0
        container_name: pulsar-manager
        hostname: pulsar-manager
        ports:
            - "19527:9527"    # Pulsar Manager Web 界面
            - "17750:7750"    # 后端服务端口
        environment:
            # 数据库配置（使用内置H2数据库）
            SPRING_PROFILES_ACTIVE: production
            SPRING_CONFIGURATION_PREVENTCIRCULARREFERENCE: "false"

            # Pulsar 集群配置
            PULSAR_CLUSTER_CLUSTER_NAME: "standalone"
            PULSAR_CLUSTER_URL: "http://pulsar-standalone:8080"
            PULSAR_CLUSTER_BROKER_URL: "pulsar://pulsar-standalone:6650"

            # 管理员账户配置
            PULSAR_MANAGER_USER: "admin"
            PULSAR_MANAGER_PASSWORD: "admin123"

            # JVM 配置
            PULSAR_MANAGER_JVM_OPTS: "-Xmx1g -Xms512m"
        depends_on:
            pulsar-standalone:
                condition: service_healthy
        volumes:
            - ./.pulsar-manager-data:/data
volumes:
    pulsardata:
    pulsarconf: