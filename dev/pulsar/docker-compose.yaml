services:
    pulsar:
        image: apachepulsar/pulsar:latest
        container_name: pulsar-standalone
        hostname: pulsar
        restart: always
        # 开放 6650 (二进制协议) 和 8080 (HTTP 管理接口)
        ports:
            - "16650:6650"
            - "18080:8080"
        environment:
            # 限制内存使用（Pulsar 默认内存分配较高，本地测试建议调小）
            - PULSAR_MEM=-Xms512m -Xmx512m -XX:MaxDirectMemorySize=1g
            # 开启延时队列功能（虽然 latest 默认通常开启，但显式声明更稳）
            - PULSAR_PREFIX_delayedDeliveryEnabled=true
        volumes:
            - dev-pulsar-data:/pulsar/data
            - dev-pulsar-conf:/pulsar/conf
        # 使用 standalone 模式启动
        command: bin/pulsar standalone
volumes:
    dev-pulsar-data:
    dev-pulsar-conf: